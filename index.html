<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CryptoLocker - NFT DeFi Platform</title>
  <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
  <script src="https://unpkg.com/thirdweb@latest/dist/thirdweb.umd.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
body {
  background: #0a0a0a;
  color: #00ff41;
  font-family: 'Courier New', monospace;
  overflow-x: hidden;
}
.bg-animation {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  background: radial-gradient(circle at 20% 50%, rgba(0, 255, 65, 0.1) 0%, transparent 50%),
              radial-gradient(circle at 80% 80%, rgba(0, 255, 65, 0.15) 0%, transparent 50%);
  animation: pulse 8s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}
.grid-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    linear-gradient(rgba(0, 255, 65, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 255, 65, 0.03) 1px, transparent 1px);
  background-size: 50px 50px;
  z-index: 1;
  pointer-events: none;
}
/* Header */
header {
  position: relative;
  z-index: 100;
  background: rgba(10, 10, 10, 0.9);
  backdrop-filter: blur(10px);
  border-bottom: 2px solid #00ff41;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.logo {
  font-size: 1.5rem;
  font-weight: bold;
  color: #00ff41;
  text-shadow: 0 0 10px #00ff41;
}
.header-controls {
  display: flex;
  gap: 1rem;
  align-items: center;
}
.connection-status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: rgba(0, 255, 65, 0.1);
  border-radius: 20px;
  font-size: 0.9rem;
}
.status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #ff4444;
  animation: blink 2s infinite;
}
.status-dot.connected {
  background: #00ff41;
  box-shadow: 0 0 10px #00ff41;
}
@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}
.container {
  position: relative;
  z-index: 10;
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
}
.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
}
.card {
  background: rgba(26, 26, 26, 0.8);
  backdrop-filter: blur(10px);
  border: 2px solid rgba(0, 255, 65, 0.3);
  border-radius: 15px;
  padding: 1.5rem;
  box-shadow: 0 8px 32px rgba(0, 255, 65, 0.1);
  transition: all 0.3s ease;
}
.card:hover {
  border-color: #00ff41;
  box-shadow: 0 8px 32px rgba(0, 255, 65, 0.3);
  transform: translateY(-5px);
}
.card h2 {
  margin-bottom: 1rem;
  font-size: 1.3rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
input, textarea, select, button {
  width: 100%;
  font-size: 1rem;
  padding: 0.8rem;
  border-radius: 8px;
  border: 1px solid rgba(0, 255, 65, 0.3);
  background: rgba(10, 10, 10, 0.5);
  color: #00ff41;
  font-family: 'Courier New', monospace;
  transition: all 0.3s ease;
}
input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: #00ff41;
  box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
}
button {
  background: transparent;
  border: 2px solid #00ff41;
  cursor: pointer;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
}
button:hover:not(:disabled) {
  background: #00ff41;
  color: #0a0a0a;
  box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
}
button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
/* Stats Section  */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}
.stat-item {
  background: rgba(0, 255, 65, 0.1);
  padding: 1rem;
  border-radius: 8px;
  text-align: center;
}
.stat-value {
  font-size: 2rem;
  font-weight: bold;
  color: #00ff41;
  text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);
}
.stat-label {
  font-size: 0.9rem;
  opacity: 0.7;
  margin-top: 0.5rem;
}
/* Connection Test */
.test-results {
  margin-top: 1rem;
  padding: 1rem;
  background: rgba(0, 255, 65, 0.05);
  border-radius: 8px;
  font-size: 0.9rem;
}
.test-item {
  display: flex;
  justify-content: space-between;
  padding: 0.5rem 0;
  border-bottom: 1px solid rgba(0, 255, 65, 0.1);
}
.test-item:last-child {
  border-bottom: none;
}
.test-status {
  font-weight: bold;
}
.test-status.success { color: #00ff41; }
.test-status.error { color: #ff4444; }
.test-status.pending { color: #ffaa00; }
/* Notifications */
.notification {
  position: fixed;
  top: 100px;
  right: 20px;
  background: rgba(26, 26, 26, 0.95);
  border: 2px solid #00ff41;
  padding: 1rem 2rem;
  border-radius: 10px;
  z-index: 1000;
  box-shadow: 0 8px 32px rgba(0, 255, 65, 0.3);
  animation: slideIn 0.3s ease;
}
@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
/* Responsive */
@media (max-width: 768px) {
  header {
    flex-direction: column;
    gap: 1rem;
  }
  .container {
    padding: 1rem;
  }
  .dashboard {
    grid-template-columns: 1fr;
  }
}
/* Loading Spinner */
.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(0, 255, 65, 0.3);
  border-radius: 50%;
  border-top-color: #00ff41;
  animation: spin 1s ease-in-out infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
}
input[type="checkbox"] {
  width: auto;
  cursor: pointer;
}
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  <div class="grid-overlay"></div>
  <header>
    <div class="logo">üîê CryptoLocker</div>
    <div class="header-controls">
      <div class="connection-status">
        <span class="status-dot" id="statusDot"></span>
        <span id="connectionText">Not Connected</span>
      </div>
      <button id="connectBtn">Connect Wallet</button>
    </div>
  </header>
  <div class="container">
    <div class="dashboard">
      <!-- Stats Card -->
      <div class="card">
        <h2>üìä Platform Stats</h2>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="totalNFTs">0</div>
            <div class="stat-label">Total NFTs</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="userBalance">0</div>
            <div class="stat-label">Your Balance</div>
          </div>
        </div>
      </div>
      <!-- Quick Mint NFT -->
      <div class="card">
        <h2>‚ö° Quick Mint NFT</h2>
        <div id="checkout-widget-container" style="margin-bottom: 1rem;"></div>
        <form id="quickMintForm">
          <input type="text" id="nftName" placeholder="NFT Name" required />
          <textarea id="nftDescription" placeholder="Description" rows="3"></textarea>
          <select id="contentType">
            <option value="image">Image</option>
            <option value="video">Video</option>
            <option value="audio">Audio</option>
            <option value="text">Text</option>
          </select>
          <input type="file" id="nftFile" accept="image/*,video/*,audio/*,text/*" />
          <button type="submit">üé® Mint NFT</button>
        </form>
      </div>
      <!-- Create Collection -->
      <div class="card">
        <h2>üìÅ Create Collection</h2>
        <form id="createCollectionForm">
          <input type="text" id="collectionName" placeholder="Collection Name" required />
          <textarea id="collectionDescription" placeholder="Description" rows="3"></textarea>
          <button type="submit">üì¶ Create Collection</button>
        </form>
      </div>
      <!-- Lock Tokens -->
      <div class="card">
        <h2>üîí Lock Tokens</h2>
        <form id="lockForm">
          <input type="text" id="tokenAddress" placeholder="Token Contract Address" required />
          <input type="number" id="lockAmount" placeholder="Amount" step="0.01" required />
          <select id="lockDuration">
            <option value="7">7 Days</option>
            <option value="30">30 Days</option>
            <option value="90">90 Days</option>
            <option value="180">180 Days</option>
            <option value="365">1 Year</option>
          </select>
          <label>
            <input type="checkbox" id="useYield" />
            <span>Enable Aave Yield Generation</span>
          </label>
          <button type="submit">üîê Lock Tokens</button>
        </form>
      </div>
    </div>
  </div>
  <script>
    // Configuration & Initialization
    const CONFIG = {
      CONTRACT_ADDRESS: '0xe274a85a123f9270d1e0617f7e04632d9d8640d9',
      BASE_CHAIN_ID: '0x2105', // 8453 in hex
      BASE_CHAIN_ID_DEC: 8453,
      BASE_RPC: 'https://mainnet.base.org',
      CONTRACT_ABI: [
        "function mintNFT(string name, string description, string contentType, string ipfsUrl, uint256 royaltyPercent, string tokenURI) public returns (uint256)",
        "function createCollection(string name, string description) public returns (uint256)",
        "function lockTokens(address tokenAddress, uint256 amount, uint256 duration, bool useYield) public",
        "function totalSupply() public view returns (uint256)"
      ]
    };
    let state = {
      provider: null,
      signer: null,
      contract: null,
      userAddress: null,
      isConnected: false
    };
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      if (type === 'error') notification.style.borderColor = '#ff4444';
      if (type === 'success') notification.style.borderColor = '#00ff41';
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 4000);
    }
    function updateConnectionUI(connected, address = null) {
      const statusDot = document.getElementById('statusDot');
      const connectionText = document.getElementById('connectionText');
      const connectBtn = document.getElementById('connectBtn');
      if (connected && address) {
        statusDot.classList.add('connected');
        connectionText.textContent = address.slice(0, 6) + '...' + address.slice(-4);
        connectBtn.textContent = 'Connected';
        connectBtn.disabled = true;
        state.isConnected = true;
      } else {
        statusDot.classList.remove('connected');
        connectionText.textContent = 'Not Connected';
        connectBtn.textContent = 'Connect Wallet';
        connectBtn.disabled = false;
        state.isConnected = false;
      }
    }
    function checkMetaMask() {
      if (typeof window.ethereum === 'undefined') {
        showNotification('‚ö†Ô∏è MetaMask not detected!', 'error');
        setTimeout(() => window.open('https://metamask.io/download/', '_blank'), 2000);
        return false;
      }
      return true;
    }
    async function switchToBase() {
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: CONFIG.BASE_CHAIN_ID }],
        });
        return true;
      } catch (error) {
        if (error.code === 4902) {
          try {
            await window.ethereum.request({
              method: 'wallet_addEthereumChain',
              params: [{
                chainId: CONFIG.BASE_CHAIN_ID,
                chainName: 'Base',
                nativeCurrency: { name: 'Ethereum', symbol: 'ETH', decimals: 18 },
                rpcUrls: [CONFIG.BASE_RPC],
                blockExplorerUrls: ['https://basescan.org']
              }],
            });
            return true;
          } catch (addError) {
            throw new Error('Failed to add Base network');
          }
        }
        throw error;
      }
    }
    async function connectWallet() {
      if (!checkMetaMask()) return;
      try {
        showNotification('üîÑ Connecting to MetaMask...');
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        state.userAddress = accounts[0];
        state.provider = new ethers.providers.Web3Provider(window.ethereum);
        state.signer = state.provider.getSigner();
        await switchToBase();
        state.contract = new ethers.Contract(
          CONFIG.CONTRACT_ADDRESS,
          CONFIG.CONTRACT_ABI,
          state.signer
        );
        updateConnectionUI(true, state.userAddress);
        showNotification('‚úÖ Wallet Connected!', 'success');
        await loadStats();
        window.ethereum.on('accountsChanged', handleAccountsChanged);
        window.ethereum.on('chainChanged', () => location.reload());
      } catch (error) {
        console.error('Connection error:', error);
        showNotification('‚ùå Connection failed: ' + error.message, 'error');
        updateConnectionUI(false);
      }
    }
    function handleAccountsChanged(accounts) {
      if (accounts.length === 0) {
        showNotification('Please connect to MetaMask', 'error');
        updateConnectionUI(false);
        location.reload();
      } else {
        state.userAddress = accounts[0];
        updateConnectionUI(true, state.userAddress);
        loadStats();
      }
    }
    async function loadStats() {
      if (!state.contract) return;
      try {
        const totalSupply = await state.contract.totalSupply();
        document.getElementById('totalNFTs').textContent = totalSupply.toString();
        if (state.provider && state.userAddress) {
          const balance = await state.provider.getBalance(state.userAddress);
          document.getElementById('userBalance').textContent = 
            parseFloat(ethers.utils.formatEther(balance)).toFixed(4) + ' ETH';
        }
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }
    // CheckoutWidget Integration
    function showCheckoutWidget({ amount, tokenAddress, chain, onSuccess }) {
      document.getElementById("checkout-widget-container").innerHTML = "";
      const widget = new thirdweb.CheckoutWidget({
        clientId: "10f433657d1018e7003e5cd1cb9c61d7",
        chain,
        amount: amount.toString(),
        tokenAddress,
        seller: "0x592B35c8917eD36c39Ef73D0F5e92B0173560b2e",
        name: "Mint NFT",
        description: "Pay to mint your NFT",
        onPaymentSuccess: onSuccess,
        onError: (error) => showNotification("Payment failed: " + error.message, "error"),
      });
      widget.render(document.getElementById("checkout-widget-container"));
    }
    // NFT Minting
    async function mintNFT(name, description, contentType, file) {
      if (!state.isConnected || !state.contract) {
        showNotification('‚ö†Ô∏è Please connect your wallet first', 'error');
        return;
      }
      try {
        showNotification('üîÑ Preparing to mint NFT...');
        const ipfsUrl = file ? "ipfs://QmExample" + Date.now() : "";
        const tokenURI = ipfsUrl || "ipfs://QmExample" + Date.now();
        const tx = await state.contract.mintNFT(
          name,
          description,
          contentType,
          ipfsUrl,
          0,
          tokenURI
        );
        showNotification('‚è≥ Transaction sent, waiting for confirmation...');
        await tx.wait();
        showNotification('‚úÖ NFT Minted Successfully!', 'success');
        document.getElementById('quickMintForm').reset();
        await loadStats();
      } catch (error) {
        console.error('Mint error:', error);
        let errorMsg = error.message;
        if (error.reason) errorMsg = error.reason;
        if (error.data?.message) errorMsg = error.data.message;
        showNotification('‚ùå Mint Error: ' + errorMsg, 'error');
      }
    }
    // Create Collection
    async function createCollection(name, description) {
      if (!state.isConnected || !state.contract) {
        showNotification('‚ö†Ô∏è Please connect your wallet first', 'error');
        return;
      }
      try {
        showNotification('üîÑ Creating collection...');
        const tx = await state.contract.createCollection(name, description);
        showNotification('‚è≥ Transaction sent, waiting for confirmation...');
        await tx.wait();
        showNotification('‚úÖ Collection Created Successfully!', 'success');
        document.getElementById('createCollectionForm').reset();
      } catch (error) {
        console.error('Collection error:', error);
        let errorMsg = error.message;
        if (error.reason) errorMsg = error.reason;
        if (error.data?.message) errorMsg = error.data.message;
        showNotification('‚ùå Error: ' + errorMsg, 'error');
      }
    }
    // Lock Tokens
    async function lockTokens(tokenAddress, amount, duration, useYield) {
      if (!state.isConnected || !state.contract) {
        showNotification('‚ö†Ô∏è Please connect your wallet first', 'error');
        return;
      }
      try {
        showNotification('üîÑ Locking tokens...');
        const amountWei = ethers.utils.parseEther(amount.toString());
        const tx = await state.contract.lockTokens(
          tokenAddress,
          amountWei,
          duration,
          useYield
        );
        showNotification('‚è≥ Transaction sent, waiting for confirmation...');
        await tx.wait();
        showNotification('‚úÖ Tokens Locked Successfully!', 'success');
        document.getElementById('lockForm').reset();
      } catch (error) {
        console.error('Lock error:', error);
        let errorMsg = error.message;
        if (error.reason) errorMsg = error.reason;
        if (error.data?.message) errorMsg = error.data.message;
        showNotification('‚ùå Error: ' + errorMsg, 'error');
      }
    }
    window.addEventListener('load', () => {
      document.getElementById('connectBtn').addEventListener('click', connectWallet);
      // Quick Mint Form with CheckoutWidget payment
      document.getElementById('quickMintForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('nftName').value;
        const description = document.getElementById('nftDescription').value;
        const contentType = document.getElementById('contentType').value;
        const file = document.getElementById('nftFile').files[0];
        showCheckoutWidget({
          amount: 0.01,
          tokenAddress: "0x0000000000000000000000000000000000000000", // ETH
          chain: "base",
          onSuccess: async () => {
            await mintNFT(name, description, contentType, file);
            document.getElementById("checkout-widget-container").innerHTML = "";
          }
        });
      });
      // Create Collection Form
      document.getElementById('createCollectionForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('collectionName').value;
        const description = document.getElementById('collectionDescription').value;
        await createCollection(name, description);
      });
      // Lock Tokens Form
      document.getElementById('lockForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const tokenAddress = document.getElementById('tokenAddress').value;
        const amount = document.getElementById('lockAmount').value;
        const duration = parseInt(document.getElementById('lockDuration').value) * 86400;
        const useYield = document.getElementById('useYield').checked;
        await lockTokens(tokenAddress, amount, duration, useYield);
      });
    });
  </script>
</body>
</html>
