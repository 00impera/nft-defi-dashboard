<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CryptoLocker - NFT DeFi Platform</title>
  <script src="https://unpkg.com/thirdweb@latest/dist/thirdweb.umd.js"></script>
  <style>
    body { background: #0a0a0a; color: #00ff41; font-family: 'Courier New', monospace; }
    .btn { background: transparent; color: #00ff41; border: 2px solid #00ff41; padding: 1rem 2rem; cursor: pointer; }
    .notification { position: fixed; top: 100px; right: 20px; background: #1a1a1a; border: 2px solid #00ff41; padding: 1rem 2rem; border-radius: 5px; z-index: 1000; }
  </style>
</head>
<body>
  <nav>
    <button class="btn" id="connectBtn">Connect Wallet</button>
  </nav>

  <main>
    <section>
      <h2>‚ö° Quick Mint NFT</h2>
      <form id="quickMintForm">
        <input type="text" id="nftName" placeholder="NFT Name" required /><br/>
        <textarea id="nftDescription" placeholder="Description"></textarea><br/>
        <select id="contentType">
          <option value="image">Image</option>
          <option value="video">Video</option>
          <option value="audio">Audio</option>
          <option value="text">Text</option>
        </select><br/>
        <input type="file" id="nftFile" accept="image/*,video/*,audio/*,text/*" /><br/>
        <button type="button" id="payAndMintBtn" class="btn">üí≥ Pay & Mint NFT</button>
        <div id="checkout-widget-container" style="margin-top: 1rem;"></div>
      </form>
    </section>

    <section>
      <h2>üìÅ Create Collection</h2>
      <form id="createCollectionForm">
        <input type="text" id="collectionName" placeholder="Collection Name" required /><br/>
        <textarea id="collectionDescription" placeholder="Description"></textarea><br/>
        <button type="submit" class="btn">Create Collection</button>
      </form>
    </section>

    <section>
      <h2>üîí Lock Tokens</h2>
      <form id="lockForm">
        <input type="text" id="tokenAddress" placeholder="Token Address" required /><br/>
        <input type="number" id="lockAmount" placeholder="Amount" step="0.01" required /><br/>
        <select id="lockDuration">
          <option value="7">7 Days</option>
          <option value="30">30 Days</option>
          <option value="90">90 Days</option>
        </select><br/>
        <label><input type="checkbox" id="useYield" /> Enable Aave Yield</label><br/>
        <button type="submit" class="btn">Lock Tokens</button>
      </form>
    </section>

    <section>
      <h2>üìä Platform Stats</h2>
      <div>Total NFTs Minted: <span id="totalNFTs">0</span></div>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const CLIENT_ID = '10f433657d1018e7003e5cd1cb9c61d7';
      const TREASURY_ADDRESS = '0x592B35c8917eD36c39Ef73D0F5e92B0173560b2e';
      const CONTRACT_ADDRESS = '0xe274a85a123f9270d1e0617f7e04632d9d8640d9';
      let CHAIN = "base";
      let sdk, contract, signer;

      // Wallet
      async function connectWallet() {
        sdk = new thirdweb.ThirdwebSDK(CHAIN, { clientId: CLIENT_ID });
        await sdk.wallet.connect("injected");
        signer = await sdk.wallet.getSigner();
        contract = await sdk.getContract(CONTRACT_ADDRESS);
        const address = await sdk.wallet.getAddress();
        document.getElementById('connectBtn').textContent = address.slice(0,6) + '...' + address.slice(-4);
        document.getElementById('connectBtn').disabled = true;
        showNotification("Wallet connected: " + address);
        loadStats();
      }

      // NFT Minting
      async function mintNFT(name, description, contentType, file) {
        if (!contract) { showNotification('‚ö†Ô∏è Please connect your wallet first'); return; }
        try {
          let ipfsUrl = "";
          if (file) ipfsUrl = await sdk.storage.upload(file);
          const tokenURI = ipfsUrl || `ipfs://QmExample${Date.now()}`;
          await contract.call("mintNFT", [name, description, contentType, ipfsUrl, 0, tokenURI]);
          showNotification("NFT Minted!");
          document.getElementById('quickMintForm').reset();
          document.getElementById('checkout-widget-container').innerHTML = '';
          loadStats();
        } catch (error) { showNotification('‚ùå Mint Error: ' + error.message); }
      }

      // Collections
      async function createCollection(name, description) {
        if (!contract) { showNotification('Please connect your wallet first'); return; }
        await contract.call("createCollection", [name, description]);
        showNotification("Collection Created!");
      }

      // DeFi Locking
      async function lockTokens(tokenAddress, amount, duration, useYield) {
        if (!contract) { showNotification('Please connect your wallet first'); return; }
        await contract.call("lockTokens", [tokenAddress, amount, duration, useYield]);
        showNotification("Tokens Locked!");
      }

      // Payments (CheckoutWidget)
      function showCheckoutWidget(name, description, onSuccess) {
        const widget = new thirdweb.CheckoutWidget({
          clientId: CLIENT_ID,
          chain: CHAIN,
          amount: "0.01",
          tokenAddress: "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",
          seller: TREASURY_ADDRESS,
          name,
          description,
          onPaymentSuccess: onSuccess,
          onError: (error) => showNotification("Payment failed: " + error.message),
        });
        widget.render(document.getElementById("checkout-widget-container"));
      }

      // Multichain
      async function switchChain(chain) {
        CHAIN = chain;
        sdk = new thirdweb.ThirdwebSDK(chain, { clientId: CLIENT_ID });
        contract = await sdk.getContract(CONTRACT_ADDRESS);
        showNotification("Switched to " + chain);
      }

      // Storage (IPFS Upload)
      async function uploadToIPFS(file) {
        return await sdk.storage.upload(file);
      }

      // UI Event Bindings
      document.getElementById("connectBtn").addEventListener("click", connectWallet);

      document.getElementById("payAndMintBtn").addEventListener("click", async () => {
        const name = document.getElementById("nftName").value;
        const description = document.getElementById("nftDescription").value;
        const file = document.getElementById("nftFile").files[0];
        showCheckoutWidget("Mint NFT: " + name, description, async () => {
          await mintNFT(name, description, "image", file);
        });
      });

      document.getElementById("quickMintForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("nftName").value;
        const description = document.getElementById("nftDescription").value;
        const file = document.getElementById("nftFile").files[0];
        await mintNFT(name, description, "image", file);
      });

      document.getElementById("createCollectionForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("collectionName").value;
        const description = document.getElementById("collectionDescription").value;
        await createCollection(name, description);
      });

      document.getElementById("lockForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const tokenAddress = document.getElementById("tokenAddress").value;
        const amount = document.getElementById("lockAmount").value;
        const duration = parseInt(document.getElementById("lockDuration").value) * 86400;
        const useYield = document.getElementById("useYield").checked;
        await lockTokens(tokenAddress, amount, duration, useYield);
      });

      // Load Stats
      async function loadStats() {
        if (!contract) return;
        try {
          const totalSupply = await contract.call('totalSupply');
          document.getElementById('totalNFTs').textContent = totalSupply.toString();
        } catch (error) {
          console.error('Error loading stats:', error);
        }
      }

      // Show Notification
      function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => { notification.remove(); }, 3000);
      }
    });
  </script>
</body>
</html>
